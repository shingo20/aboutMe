<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>YouTube æŒ‡å®šæ™‚åˆ»ã§é€šçŸ¥ï¼†è‡ªå‹•å†ç”Ÿ</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    body{margin:0;font-family:sans-serif;background:#0f172a;color:#f9fafb;padding:20px}
    .card{background:#111827;padding:20px;border-radius:16px;max-width:600px;margin:auto}
    label{display:block;margin:12px 0 6px}
    input,button{font:inherit;padding:10px;border-radius:8px}
    input[type="url"],input[type="datetime-local"]{width:100%;border:1px solid #444;background:#0b1020;color:white}
    .btn{margin-top:12px;padding:12px 16px;border:none;cursor:pointer;border-radius:8px;font-weight:bold}
    .primary{background:#22d3ee;color:#06202a}
    .ghost{background:transparent;border:1px solid #888;color:white}
    .list{margin-top:20px}
    .item{background:#1e293b;padding:12px;border-radius:10px;margin-bottom:10px}
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ“º YouTube æŒ‡å®šæ™‚åˆ»ã§é€šçŸ¥</h1>
    <p>URLã¨æ—¥æ™‚ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã®æ™‚åˆ»ã«é€šçŸ¥ãŒå±Šãã€ã‚¯ãƒªãƒƒã‚¯ã§YouTubeã‚’é–‹ãã¾ã™ã€‚</p>

    <label for="videoUrl">YouTubeå‹•ç”»URL</label>
    <input id="videoUrl" type="url" placeholder="https://www.youtube.com/watch?v=XXXXXXXX" />

    <label for="onceDateTime">æ—¥æ™‚</label>
    <input id="onceDateTime" type="datetime-local" />

    <button id="enableNotif" class="btn ghost" type="button">ğŸ”” é€šçŸ¥ã‚’è¨±å¯</button>
    <button id="addSchedule" class="btn primary" type="button">â–¶ äºˆç´„ã‚’è¿½åŠ </button>

    <div id="status" style="margin-top:12px;font-size:14px;color:#9ca3af">æº–å‚™ä¸­</div>

    <h3>ğŸ“… ç™»éŒ²æ¸ˆã¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
    <div id="list" class="list"></div>
  </div>

  <script>
    // ===== é€šçŸ¥ã®è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ =====
    async function requestNotificationPermission() {
      if (!("Notification" in window)) { alert("é€šçŸ¥æœªå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ã™"); return "unsupported"; }
      if (Notification.permission === "granted") return "granted";
      if (Notification.permission === "denied") return "denied";
      return await Notification.requestPermission();
    }

    function notify(title, body, url) {
      if (Notification.permission === "granted") {
        const n = new Notification(title, { body });
        n.onclick = () => { window.open(url, "_blank"); };
      }
    }

    // ===== ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç† =====
    const listEl = document.getElementById("list");
    const statusEl = document.getElementById("status");
    let schedules = [];

    function addSchedule(videoUrl, datetime) {
      const dt = new Date(datetime).getTime();
      if (!videoUrl || !dt) { alert("URLã¨æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
      const s = { id: Date.now(), videoUrl, dt };
      schedules.push(s);
      renderList();
    }

    function renderList() {
      listEl.innerHTML = "";
      for (const s of schedules) {
        const d = new Date(s.dt);
        const item = document.createElement("div");
        item.className = "item";
        item.textContent = `${d.toLocaleString()} - ${s.videoUrl}`;
        listEl.appendChild(item);
      }
    }

    function tick() {
      const now = Date.now();
      for (const s of schedules) {
        if (!s.fired && now >= s.dt) {
          notify("æ™‚é–“ã«ãªã‚Šã¾ã—ãŸ â°", "YouTubeã‚’é–‹ãã¾ã™", s.videoUrl);
          s.fired = true;
        }
      }
      const next = schedules.filter(s=>!s.fired).map(s=>s.dt).sort()[0];
      if (next) {
        const remain = Math.max(0, next - now);
        const mins = Math.floor(remain / 60000);
        const secs = Math.floor((remain % 60000)/1000);
        statusEl.textContent = `æ¬¡ã®ç™ºç«ã¾ã§ ${mins}åˆ†${secs}ç§’`;
      } else {
        statusEl.textContent = "æº–å‚™ä¸­";
      }
    }
    setInterval(tick,1000);

    // ===== ã‚¤ãƒ™ãƒ³ãƒˆ =====
    document.getElementById("enableNotif").onclick = requestNotificationPermission;
    document.getElementById("addSchedule").onclick = () => {
      addSchedule(
        document.getElementById("videoUrl").value,
        document.getElementById("onceDateTime").value
      );
    };
  </script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>YouTube 指定時刻ジャンプ（通知＋自動再生）</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    body {
      font-family: sans-serif;
      background: #f1f5f9;
      color: #111827;
      padding: 2rem;
    }
    input, button {
      margin: 0.5rem 0;
      padding: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>YouTube 指定時刻ジャンプ</h1>
  <label>再生したいYouTubeのURL: 
    <input id="youtubeUrl" type="text" placeholder="https://www.youtube.com/watch?v=xxxxxx">
  </label><br>
  <label>開始時間（秒）: 
    <input id="startTime" type="number" value="0">
  </label><br>
  <label>起動時刻（HH:MM 形式）: 
    <input id="targetTime" type="time">
  </label><br>
  <button id="setTimer">開始する</button>

  <script>
    // 通知許可リクエスト
    if ("Notification" in window && Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    document.getElementById("setTimer").addEventListener("click", () => {
      const url = document.getElementById("youtubeUrl").value.trim();
      const startTime = parseInt(document.getElementById("startTime").value, 10) || 0;
      const timeInput = document.getElementById("targetTime").value;

      if (!url || !timeInput) {
        alert("URLと時刻を入力してください。");
        return;
      }

      const [hour, minute] = timeInput.split(":").map(Number);
      const now = new Date();
      const target = new Date();

      target.setHours(hour, minute, 0, 0);
      if (target < now) {
        target.setDate(target.getDate() + 1);
      }

      const diff = target - now;
      alert(`YouTubeを ${target.toLocaleTimeString()} に自動再生します。`);

      setTimeout(() => {
        const playUrl = url.includes("?") 
          ? `${url}&t=${startTime}s`
          : `${url}?t=${startTime}s`;

        // 通知を表示
        if ("serviceWorker" in navigator && "showNotification" in ServiceWorkerRegistration.prototype) {
          navigator.serviceWorker.ready.then((registration) => {
            registration.showNotification("YouTube自動再生", {
              body: "指定時刻になりました！新しいタブでYouTubeを再生します。",
              icon: "icons/icon-192.png",
              data: { url: playUrl }
            });
          });
        }

        // 新しいタブで自動再生
        window.open(playUrl, "_blank");
      }, diff);
    });

    // PWA用 Service Worker 登録
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js");
    }
  </script>
</body>
</html>
